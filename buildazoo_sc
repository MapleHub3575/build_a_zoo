-- üå∏ Maple Hub (Clean Version - No Print/No Warn)
local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()
local Players = game:GetService("Players")
local TeleportService = game:GetService("TeleportService")
local HttpService = game:GetService("HttpService")
local LocalPlayer = Players.LocalPlayer

-- üìÅ ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ü‡∏•‡πå Config
local folderName = "MapleHub"
local fileName = folderName .. "/MapleConfig.json"

if not isfolder(folderName) then
    makefolder(folderName)
end

-- üåü ‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
local Config = {
    AutoFarm = false,
    FarmDelay = 15,
    AutoRejoin = false,
    RejoinDelay = 5
}

-- üîÑ ‡πÇ‡∏´‡∏•‡∏î Config ‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
if isfile(fileName) then
    local data = readfile(fileName)
    local success, decoded = pcall(function()
        return HttpService:JSONDecode(data)
    end)
    if success and typeof(decoded) == "table" then
        Config = decoded
    end
end

-- üíæ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å Config
local function SaveConfig()
    writefile(fileName, HttpService:JSONEncode(Config))
end

-- ü™ü ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á UI
local Window = Rayfield:CreateWindow({
    Name = "Maple Hub",
    LoadingTitle = "Maple Hub Loading...",
    LoadingSubtitle = "by Maple_D",
    ConfigurationSaving = {
        Enabled = false
    },
})

-- üåæ ‡πÅ‡∏ó‡πá‡∏ö Farm
local FarmTab = Window:CreateTab("üåæ Farm", 4483362458)
FarmTab:CreateToggle({
    Name = "Auto Farm",
    CurrentValue = Config.AutoFarm,
    Flag = "AutoFarm",
    Callback = function(Value)
        Config.AutoFarm = Value
        SaveConfig()
    end,
})

FarmTab:CreateSlider({
    Name = "Delay Farm",
    Range = {0.1, 100},
    Increment = 1,
    Suffix = "s",
    CurrentValue = Config.FarmDelay,
    Flag = "FarmDelay",
    Callback = function(Value)
        Config.FarmDelay = Value
        SaveConfig()
    end,
})

-- ‚öô ‡πÅ‡∏ó‡πá‡∏ö Main
local MainTab = Window:CreateTab("‚öô Main", 4483362458)
MainTab:CreateToggle({
    Name = "Auto Rejoin",
    CurrentValue = Config.AutoRejoin,
    Flag = "AutoRejoin",
    Callback = function(Value)
        Config.AutoRejoin = Value
        SaveConfig()
    end,
})

MainTab:CreateSlider({
    Name = "Rejoin Delay",
    Range = {1, 30},
    Increment = 1,
    Suffix = "s",
    CurrentValue = Config.RejoinDelay,
    Flag = "RejoinDelay",
    Callback = function(Value)
        Config.RejoinDelay = Value
        SaveConfig()
    end,
})

-- üîÅ ‡∏õ‡∏∏‡πà‡∏° Reset Config
MainTab:CreateButton({
    Name = "üîÑ Reset Config",
    Callback = function()
        Config = {
            AutoFarm = false,
            FarmDelay = 15,
            AutoRejoin = false,
            RejoinDelay = 5
        }
        SaveConfig()
        Rayfield:Notify({
            Title = "Config Reset!",
            Content = "‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Ñ‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÅ‡∏•‡πâ‡∏ß",
            Duration = 3
        })
    end,
})

-- üêæ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏£‡∏≠ Pets Folder
local function WaitForPetsFolder()
    return workspace:WaitForChild("Pets", 10)
end

-- üöú Auto Farm Logic
task.spawn(function()
    local petsFolder = WaitForPetsFolder()
    if not petsFolder then return end

    while true do
        if Config.AutoFarm then
            for _, pet in pairs(petsFolder:GetChildren()) do
                local root = pet:FindFirstChild("RootPart")
                if root then
                    local remote = root:FindFirstChild("RE")
                    if remote and remote:IsA("RemoteEvent") then
                        pcall(function()
                            remote:FireServer("Claim")
                        end)
                    end
                end
            end
            task.wait(Config.FarmDelay)
        else
            task.wait(1)
        end
    end
end)

-- üß± ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏´‡∏≤ PromptGui ‡πÅ‡∏ö‡∏ö‡πÑ‡∏°‡πà‡∏Ñ‡πâ‡∏≤‡∏á
local function WaitForPromptGui()
    return game:GetService("CoreGui"):FindFirstChild("PromptGui")
end

-- üîÑ Auto Rejoin Logic
task.spawn(function()
    local promptGui = WaitForPromptGui()
    if promptGui and promptGui:FindFirstChild("promptOverlay") then
        promptGui.promptOverlay.ChildAdded:Connect(function(obj)
            if obj.Name == "ErrorPrompt" and Config.AutoRejoin then
                task.spawn(function()
                    task.wait(Config.RejoinDelay)
                    pcall(function()
                        TeleportService:TeleportToPlaceInstance(game.PlaceId, game.JobId, LocalPlayer)
                    end)
                end)
            end
        end)
    end
end)
